<% include ../partials/header %>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.js"></script>

<!-- These just hold data that I want to transfer from the backend javascript to the front end javascript -->
<h2 style="display:none;" id="gradesObj"><%=JSON.stringify(grades)%></h2>
<p style="display:none;" id="bodyColorHolder"> <%= course.color %> </p>

<div class="container">
    <header class="course-show-head">
        <h2><%= course.name %></h2>
        <h3><%= course.percentage.toFixed(2) %>%</h3>
    </header>

    <section class="graph-section">
        <canvas id="gradeGraph"></canvas>
    </section>

    <section class="grades">
        <a href="/courses/<%= course._id %>/grade/new">New grade</a>

        <% for(var i = grades.length - 1; i > -1; i--){ %>
            <div class="grade">
                <div class="grade-title">
                    <h4><%= grades[i].name %></h4>
                </div>
                <div class="grade-category">
                    <p><%= grades[i].categoryName %></p>
                </div>
                <div class="grade-score">
                    <p><%= grades[i].pointsRecieved %>/<%= grades[i].possiblePoints %></p>
                </div>
                <div class="grade-percentage">
                    <p><%= grades[i].percentage %>%</p>
                </div>
                <div class="grade-edit">
                    <a href="/courses/<%= course._id %>/grade/<%= grades[i]._id %>/edit">
                        Edit
                    </a>
                </div>
            </div>
            <% } %>

    </section>

</div>

<script>

    //set background color
    colorColorHex = document.getElementById("bodyColorHolder").textContent.trim();
    document.body.style.background = "linear-gradient(to right," + colorColorHex + "3d, "  + colorColorHex + "67, " + colorColorHex + "3d)";

    let navText = document.getElementsByClassName("nav-text");
    console.log(navText.length)
    for(var i = 0; i < navText.length; i++){
        navText[i].style.color = colorColorHex;
    }
    


    //put the grades in the graph
    var gradesList = JSON.parse(document.getElementById("gradesObj").innerText);

    function getField(input, field) {
        var output = [];
        input.forEach((inp) => output.push(inp[field]))
        return output
    }
    
    let graph = document.getElementById("gradeGraph").getContext("2d");
    Chart.defaults.global.defaultFontColor = 'black';
    let GradeGraph = new Chart(graph, {
        type: "bar",

        data: {
            labels: getField(gradesList, "name"),

            datasets: [
                {
                    label: "Course Percentage",
                    data: getField(gradesList, "coursePercentAfterThisGradeIsadded"),
                    type: "line",
                    backgroundColor: "rgba(0,0,0,0)",
                    backgroundColor: "rgba(0,0,0,0)",
                    borderWidth: 3,
                    borderColor: "#000",
                    hoverBorderWidth: 2.3
                },
                {
                    type: "bar",
                    label: "Grade Percentage",
                    data: getField(gradesList, "percentage"),
                    backgroundColor: getField(gradesList, "categoryColor"),
                    borderWidth: 1.5,
                    borderColor: "#777",
                    hoverBorderWidth: 2.3,
                    hoverBorderColor: "#000"
                }
            ]
        },
        options: {
            legend:{
                labels:{
                    fontColor: 'black'
                }
            }
        }
    })
</script> 

<% include ../partials/footer %>